# ãƒ¯ãƒ¼ã‚¯ã‚¢ã‚¦ãƒˆè¨­å®šåˆ†é›¢æ©Ÿèƒ½ - ãƒªã‚¹ã‚¯è©•ä¾¡ãƒãƒˆãƒªã‚¯ã‚¹

**æ–‡æ›¸ç•ªå·**: RAM-WS-001
**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 1.0.0
**ä½œæˆæ—¥**: 2025-09-16
**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: Draft

## 1. ãƒªã‚¹ã‚¯è©•ä¾¡ã‚µãƒãƒªãƒ¼

### ãƒªã‚¹ã‚¯ãƒ¬ãƒ™ãƒ«åˆ†é¡
- ğŸ”´ **é«˜ãƒªã‚¹ã‚¯**: å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå¿…é ˆå‚ç…§ã€æ…é‡ãªå®Ÿè£…ãŒå¿…è¦
- ğŸŸ¡ **ä¸­ãƒªã‚¹ã‚¯**: ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã€éƒ¨åˆ†çš„ã«ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå‚ç…§
- ğŸŸ¢ **ä½ãƒªã‚¹ã‚¯**: æ¨™æº–çš„ãªå®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³ã§å¯¾å¿œå¯èƒ½

## 2. é«˜ãƒªã‚¹ã‚¯é ˜åŸŸï¼ˆå…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ·±æ˜ã‚Šå¿…é ˆï¼‰

| é …ç›® | ãƒªã‚¹ã‚¯ | å½±éŸ¿åº¦ | å¯¾ç­– | å‚ç…§URL |
|------|--------|--------|------|---------|
| **LocalStorageå®¹é‡è¶…é** | 5-10MBåˆ¶é™ã‚’è¶…éã™ã‚‹ã¨ãƒ‡ãƒ¼ã‚¿ä¿å­˜å¤±æ•— | é«˜ | å®¹é‡ãƒã‚§ãƒƒã‚¯å®Ÿè£…ã€ãƒ‡ãƒ¼ã‚¿åœ§ç¸® | [MDN Web Storage API](https://developer.mozilla.org/en-US/docs/Web/API/Web_Storage_API/Using_the_Web_Storage_API#storage_limit) |
| **ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒ–ãƒ©ã‚¦ã‚¸ãƒ³ã‚°** | LocalStorageä½¿ç”¨ä¸å¯ã§ã‚¢ãƒ—ãƒªå‹•ä½œä¸èƒ½ | é«˜ | ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å®Ÿè£…å¿…é ˆ | [MDN Storage quotas and eviction criteria](https://developer.mozilla.org/en-US/docs/Web/API/Storage_API/Storage_quotas_and_eviction_criteria) |
| **ãƒ‡ãƒ¼ã‚¿ç«¶åˆçŠ¶æ…‹** | è¤‡æ•°ã‚¿ãƒ–ã§ã®åŒæ™‚ç·¨é›†ã«ã‚ˆã‚‹ä¸æ•´åˆ | é«˜ | StorageEventãƒªã‚¹ãƒŠãƒ¼å®Ÿè£… | [MDN StorageEvent](https://developer.mozilla.org/en-US/docs/Web/API/StorageEvent) |
| **XSSè„†å¼±æ€§** | æ‚ªæ„ã‚ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆå®Ÿè¡Œãƒªã‚¹ã‚¯ | é«˜ | å…¥åŠ›å€¤ã‚µãƒ‹ã‚¿ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³ | [React Security](https://legacy.reactjs.org/docs/introducing-jsx.html#jsx-prevents-injection-attacks) |

### å®Ÿè£…ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆï¼ˆé«˜ãƒªã‚¹ã‚¯é …ç›®ï¼‰

```javascript
// âš ï¸ STOP: LocalStorageæ“ä½œå‰ã«å¿…ãšç¢ºèª

// 1. å®¹é‡ãƒã‚§ãƒƒã‚¯
function checkStorageQuota() {
  if ('storage' in navigator && 'estimate' in navigator.storage) {
    return navigator.storage.estimate().then(({usage, quota}) => {
      const percentUsed = (usage / quota) * 100;
      if (percentUsed > 90) {
        console.warn(`Storage usage: ${percentUsed.toFixed(2)}%`);
      }
      return percentUsed < 95; // 95%æœªæº€ãªã‚‰å®‰å…¨
    });
  }
  return Promise.resolve(true); // APIæœªå¯¾å¿œã®å ´åˆã¯ç¶šè¡Œ
}

// 2. ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒ–ãƒ©ã‚¦ã‚¸ãƒ³ã‚°æ¤œå‡º
function isStorageAvailable() {
  try {
    const test = '__storage_test__';
    localStorage.setItem(test, test);
    localStorage.removeItem(test);
    return true;
  } catch (e) {
    return false;
  }
}

// 3. è¤‡æ•°ã‚¿ãƒ–åŒæœŸ
window.addEventListener('storage', (e) => {
  if (e.key === 'fittrack.config.form' && e.newValue) {
    // ä»–ã®ã‚¿ãƒ–ã§å¤‰æ›´ã•ã‚ŒãŸè¨­å®šã‚’åæ˜ 
    const newConfig = JSON.parse(e.newValue);
    updateLocalState(newConfig);
  }
});
```

## 3. ä¸­ãƒªã‚¹ã‚¯é ˜åŸŸï¼ˆãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ã‚¢ãƒ—ãƒ­ãƒ¼ãƒï¼‰

| é …ç›® | ãƒªã‚¹ã‚¯ | å½±éŸ¿åº¦ | å¯¾ç­– | å‚ç…§ç®‡æ‰€ |
|------|--------|--------|------|----------|
| **React 18 Strict Mode** | useEffectã®äºŒé‡å®Ÿè¡Œ | ä¸­ | ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—é©åˆ‡å®Ÿè£… | [React Strict Mode](https://react.dev/reference/react/StrictMode) |
| **çŠ¶æ…‹ç®¡ç†ã®è¤‡é›‘æ€§** | è¨­å®šåŒæœŸæ™‚ã®çŠ¶æ…‹ä¸æ•´åˆ | ä¸­ | å˜æ–¹å‘ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼ç¶­æŒ | å†…éƒ¨è¨­è¨ˆæ›¸å‚ç…§ |
| **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹åŠ£åŒ–** | å¤§é‡ãƒ‡ãƒ¼ã‚¿ã§ã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°é…å»¶ | ä¸­ | ãƒ¡ãƒ¢åŒ–ã€ä»®æƒ³ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ« | [React Performance](https://react.dev/learn/render-and-commit) |
| **ãƒãƒ¼ã‚¸ãƒ§ãƒ³äº’æ›æ€§** | å°†æ¥çš„ãªè¨­å®šãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆå¤‰æ›´ | ä¸­ | ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æˆ¦ç•¥ | å†…éƒ¨å®Ÿè£… |

### ä¸­ãƒªã‚¹ã‚¯é …ç›®ã®å®Ÿè£…æŒ‡é‡

```javascript
// React 18 Strict Modeå¯¾ç­–
useEffect(() => {
  let isSubscribed = true;

  const loadConfig = async () => {
    const config = await fetchConfig();
    if (isSubscribed) {
      setConfig(config);
    }
  };

  loadConfig();

  return () => {
    isSubscribed = false; // ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã§è³¼èª­è§£é™¤
  };
}, []);

// ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–
const ExerciseList = memo(({ exercises, onToggle }) => {
  // React.memoã§ä¸è¦ãªå†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°é˜²æ­¢
  return exercises.map(exercise => (
    <ExerciseItem key={exercise.id} {...exercise} onToggle={onToggle} />
  ));
}, (prevProps, nextProps) => {
  // ã‚«ã‚¹ã‚¿ãƒ æ¯”è¼ƒé–¢æ•°
  return prevProps.exercises === nextProps.exercises;
});
```

## 4. ä½ãƒªã‚¹ã‚¯é ˜åŸŸï¼ˆæ¨™æº–å®Ÿè£…ã§å¯¾å¿œå¯èƒ½ï¼‰

| é …ç›® | ç†ç”± | æ¤œè¨¼æ–¹æ³• |
|------|------|----------|
| **UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå®Ÿè£…** | Material-UIæ¨™æº–ãƒ‘ã‚¿ãƒ¼ãƒ³ã§å®Ÿè£…å¯èƒ½ | ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ†ã‚¹ãƒˆ |
| **ãƒ•ã‚©ãƒ¼ãƒ ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³** | Yup/React Hook Formæ¨™æº–æ©Ÿèƒ½ã§å¯¾å¿œ | å˜ä½“ãƒ†ã‚¹ãƒˆ |
| **åŸºæœ¬çš„ãªçŠ¶æ…‹ç®¡ç†** | useState/useReducerã§ååˆ† | çµ±åˆãƒ†ã‚¹ãƒˆ |
| **ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°** | MUI theming systemã§å¯¾å¿œ | ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«ãƒ†ã‚¹ãƒˆ |

## 5. å®Ÿè£…åˆ¤æ–­ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆ

```mermaid
graph TD
    A[æ–°æ©Ÿèƒ½å®Ÿè£…] --> B{ãƒ‡ãƒ¼ã‚¿æ°¸ç¶šåŒ–å¿…è¦?}
    B -->|Yes| C{LocalStorageä½¿ç”¨?}
    C -->|Yes| D[ğŸ”´ é«˜ãƒªã‚¹ã‚¯<br/>å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå¿…é ˆ]
    C -->|No| E{çŠ¶æ…‹ç®¡ç†ã®ã¿?}
    B -->|No| F{UIå®Ÿè£…ã®ã¿?}

    E -->|Yes| G{è¤‡æ•°ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆé–“å…±æœ‰?}
    G -->|Yes| H[ğŸŸ¡ ä¸­ãƒªã‚¹ã‚¯<br/>è¨­è¨ˆæ›¸å‚ç…§]
    G -->|No| I[ğŸŸ¢ ä½ãƒªã‚¹ã‚¯<br/>æ¨™æº–å®Ÿè£…]

    F -->|Yes| I
    F -->|No| H

    D --> J[å®Ÿè£…å‰ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆç¢ºèª]
    H --> K[è¨­è¨ˆãƒ¬ãƒ“ãƒ¥ãƒ¼å®Ÿæ–½]
    I --> L[é€šå¸¸å®Ÿè£…é–‹å§‹]
```

## 6. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒªã‚¹ã‚¯ãƒãƒˆãƒªã‚¯ã‚¹

### 6.1 è„…å¨ãƒ¢ãƒ‡ãƒ«

| è„…å¨ | æ”»æ’ƒãƒ™ã‚¯ã‚¿ãƒ¼ | å½±éŸ¿ | å¯¾ç­–å„ªå…ˆåº¦ | ç·©å’Œç­– |
|------|------------|------|-----------|--------|
| XSSæ”»æ’ƒ | ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ | é«˜ | å¿…é ˆ | å…¥åŠ›å€¤ã‚µãƒ‹ã‚¿ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³ |
| ãƒ‡ãƒ¼ã‚¿æ”¹ã–ã‚“ | LocalStorageç›´æ¥ç·¨é›† | ä¸­ | æ¨å¥¨ | ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§ãƒã‚§ãƒƒã‚¯ |
| DoSæ”»æ’ƒ | å¤§é‡ãƒ‡ãƒ¼ã‚¿ä¿å­˜ | ä½ | ã‚ªãƒ—ã‚·ãƒ§ãƒ³ | å®¹é‡åˆ¶é™å®Ÿè£… |
| æƒ…å ±æ¼æ´© | å…±æœ‰ç«¯æœ«ã§ã®ãƒ‡ãƒ¼ã‚¿æ®‹å­˜ | ä¸­ | æ¨å¥¨ | ã‚»ãƒƒã‚·ãƒ§ãƒ³çµ‚äº†æ™‚ã‚¯ãƒªã‚¢ |

### 6.2 ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å®Ÿè£…ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

```javascript
// âœ… å¿…é ˆå®Ÿè£…é …ç›®

// 1. XSSå¯¾ç­–: å…¥åŠ›å€¤ã®ã‚µãƒ‹ã‚¿ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³
const sanitizeInput = (input) => {
  return String(input)
    .replace(/[<>]/g, '') // åŸºæœ¬çš„ãªHTMLã‚¿ã‚°é™¤å»
    .trim()
    .slice(0, 100); // é•·ã•åˆ¶é™
};

// 2. ãƒ‡ãƒ¼ã‚¿æ¤œè¨¼: ã‚¹ã‚­ãƒ¼ãƒãƒ™ãƒ¼ã‚¹æ¤œè¨¼
const validateConfig = (config) => {
  try {
    configSchema.validateSync(config);
    return true;
  } catch (error) {
    console.error('Config validation failed:', error);
    return false;
  }
};

// 3. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°: æ©Ÿå¯†æƒ…å ±ã‚’éœ²å‡ºã—ãªã„
const safeErrorHandler = (error) => {
  // æœ¬ç•ªç’°å¢ƒã§ã¯è©³ç´°ã‚’éš è”½
  if (process.env.NODE_ENV === 'production') {
    console.error('An error occurred');
    // ãƒ­ã‚°ã‚µãƒ¼ãƒ“ã‚¹ã«é€ä¿¡
  } else {
    console.error('Error details:', error);
  }
};
```

## 7. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒªã‚¹ã‚¯è©•ä¾¡

| é ˜åŸŸ | ãƒªã‚¹ã‚¯ | æ¸¬å®šæŒ‡æ¨™ | é–¾å€¤ | å¯¾ç­– |
|------|--------|---------|------|------|
| åˆæœŸèª­ã¿è¾¼ã¿ | é…å»¶ | Time to Interactive | <3ç§’ | é…å»¶èª­ã¿è¾¼ã¿ |
| è¨­å®šä¿å­˜ | ãƒ–ãƒ­ãƒƒã‚­ãƒ³ã‚° | ä¿å­˜æ™‚é–“ | <100ms | éåŒæœŸå‡¦ç† |
| ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚° | ã‚¸ãƒ£ãƒ³ã‚¯ | FPS | >60fps | ãƒ¡ãƒ¢åŒ– |
| ãƒ¡ãƒ¢ãƒªä½¿ç”¨ | ãƒªãƒ¼ã‚¯ | Heap Size | <50MB | é©åˆ‡ãªã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ— |

## 8. é‹ç”¨ãƒªã‚¹ã‚¯ã¨å¯¾ç­–

### 8.1 ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆãƒªã‚¹ã‚¯

| ãƒ•ã‚§ãƒ¼ã‚º | ãƒªã‚¹ã‚¯ | å½±éŸ¿åº¦ | ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯æ‰‹é † |
|---------|--------|--------|----------------|
| Phase 1 | ãƒ‡ãƒ¼ã‚¿ç§»è¡Œå¤±æ•— | é«˜ | æ—§è¨­å®šã«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ |
| Phase 2 | ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹åŠ£åŒ– | ä¸­ | ãƒ•ã‚£ãƒ¼ãƒãƒ£ãƒ¼ãƒ•ãƒ©ã‚°ç„¡åŠ¹åŒ– |
| Phase 3 | ãƒ¦ãƒ¼ã‚¶ãƒ¼æ··ä¹± | ä½ | UIã‚¬ã‚¤ãƒ‰è¡¨ç¤º |

### 8.2 ç›£è¦–é …ç›®

```javascript
// é‹ç”¨ç›£è¦–ç”¨ãƒ¡ãƒˆãƒªã‚¯ã‚¹
const metrics = {
  // ã‚¨ãƒ©ãƒ¼ç‡
  errorRate: {
    threshold: 0.01, // 1%
    action: 'ã‚¢ãƒ©ãƒ¼ãƒˆé€šçŸ¥'
  },
  // å¿œç­”æ™‚é–“
  responseTime: {
    threshold: 1000, // 1ç§’
    action: 'ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹èª¿æŸ»'
  },
  // ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ä½¿ç”¨ç‡
  storageUsage: {
    threshold: 0.8, // 80%
    action: 'ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—å®Ÿè¡Œ'
  }
};
```

## 9. ãƒªã‚¹ã‚¯å¯¾å¿œå„ªå…ˆé †ä½

### 9.1 å®Ÿè£…é †åºï¼ˆãƒªã‚¹ã‚¯è€ƒæ…®ï¼‰

1. **Week 1**: é«˜ãƒªã‚¹ã‚¯é …ç›®ã®å¯¾ç­–å®Ÿè£…
   - LocalStorageæŠ½è±¡åŒ–å±¤
   - ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°åŸºç›¤
   - ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾ç­–

2. **Week 2**: ä¸­ãƒªã‚¹ã‚¯é …ç›®ã®å®Ÿè£…
   - çŠ¶æ…‹ç®¡ç†ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£
   - ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

3. **Week 3**: ä½ãƒªã‚¹ã‚¯é …ç›®ã¨UIå®Ÿè£…
   - UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
   - ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯

### 9.2 ç¶™ç¶šçš„ãƒªã‚¹ã‚¯ç®¡ç†

- é€±æ¬¡ãƒªã‚¹ã‚¯ãƒ¬ãƒ“ãƒ¥ãƒ¼å®Ÿæ–½
- æ–°è¦ãƒªã‚¹ã‚¯ã®ç‰¹å®šã¨è©•ä¾¡
- å¯¾ç­–ã®åŠ¹æœæ¸¬å®š
- ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–°

## 10. ã‚¨ã‚¹ã‚«ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³åŸºæº–

### 10.1 å³æ™‚ã‚¨ã‚¹ã‚«ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å¿…è¦

- LocalStorageå®Œå…¨åˆ©ç”¨ä¸å¯ã®ç’°å¢ƒç™ºè¦‹
- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è„†å¼±æ€§ã®ç™ºè¦‹
- ãƒ‡ãƒ¼ã‚¿æå¤±ã®å¯èƒ½æ€§
- äº’æ›æ€§ã®é‡å¤§ãªå•é¡Œ

### 10.2 é€šå¸¸ã‚¨ã‚¹ã‚«ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³

- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›®æ¨™æœªé”æˆ
- ãƒ¦ãƒ¼ã‚¶ãƒ“ãƒªãƒ†ã‚£ã®å•é¡Œ
- è»½å¾®ãªãƒã‚°ã®è“„ç©