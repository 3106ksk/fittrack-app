# 機能仕様書: 最近のワークアウト表示順序バグ修正

**機能ブランチ**: `002-recentworkoutsaccordin`
**作成日**: 2025-10-12
**ステータス**: ドラフト
**入力**: ユーザー説明: "recentworkoutsaccordinの表示が降順になっていないバグ修正"

## ユーザーシナリオ & テスト *(必須)*

### ユーザーストーリー 1 - 最新のワークアウトを最初に表示 (優先度: P1)

フィットネスアプリユーザーとして、ダッシュボードで最近のワークアウトアコーディオンを開いたとき、最新のワークアウトエントリが一番上に表示される必要があります。これにより、スクロールや古いエントリの検索なしに、最新のアクティビティを素早く確認できます。

**優先度の理由**: これは「最近のワークアウト」機能の中核です。ユーザーは最新のアイテムが最初に来る時系列順を期待しており、このバグは主要なユースケース（最近のアクティビティの確認）に直接影響します。

**独立テスト**: 異なる日付（10月5日、8日、11日など）に複数のワークアウトエントリを作成し、アコーディオンを開いて、日付が降順（最新から最古へ）で表示されることを確認することで、完全にテスト可能です。これにより、期待される動作を復元する即時の価値が提供されます。

**受入シナリオ**:

1. **前提**: 10月5日、8日、11日にワークアウトが記録されている、**実行**: 最近のワークアウトアコーディオンを開く、**期待**: 日付が次の順序で表示される：10月11日が最初、10月8日が2番目、10月5日が3番目
2. **前提**: 複数の日付にわたって10件以下のワークアウトがある、**実行**: 最近のワークアウトリストを表示する、**期待**: すべての日付が最新から最古へソートされている
3. **前提**: 今日新しいワークアウトを完了したばかり、**実行**: ダッシュボードを更新してアコーディオンを開く、**期待**: 今日の日付がリストの一番上に表示される

---

### ユーザーストーリー 2 - 同日の複数ワークアウトを時系列順に表示 (優先度: P2)

1日に複数のワークアウトセッションを行うユーザーとして、同じ日付でグループ化されたワークアウトを表示するとき、それらが時刻順（最新が最初）に並んでいる必要があります。これにより、1日を通じたトレーニングセッションの順序を追跡できます。

**優先度の理由**: これは、複数の日次ワークアウトを行うユーザーの時系列表示体験を向上させます。P1（日付順序）ほど重要ではありませんが、時間ベースの表示ロジックの一貫性を保証します。

**独立テスト**: 同じ日付に異なる時刻で3つ以上のワークアウトを作成し、それらがその日付グループ内で逆時系列順（最新の時刻が最初）で表示されることを確認することで、独立してテスト可能です。

**受入シナリオ**:

1. **前提**: 10月11日に09:00、14:30、18:00に作成された3つのワークアウトがある、**実行**: アコーディオンでその日付グループを表示する、**期待**: ワークアウトが次の順序で表示される：18:00が最初、14:30が2番目、09:00が3番目
2. **前提**: 同日のワークアウトに[HH:mm]形式でタイムスタンプが表示されている、**実行**: リストを表示する、**期待**: 各日付グループ内で時刻が上から下へ減少する

---

### エッジケース

- ワークアウトがまだない場合は？ → 「まだワークアウト記録がありません」メッセージを表示（既存の動作）
- ワークアウトがちょうど1件の場合は？ → 順序の問題なく、単一の日付の下に正しく表示される
- 10件すべてのワークアウトが同じ日に発生した場合は？ → 時刻順（最新が最初）で並んだ10件のワークアウトを持つ単一の日付を表示
- ワークアウトのタイムスタンプが同一の場合は？ → エラーを起こさず、データソースから受信した順序で表示
- データに10件を超えるワークアウトが含まれる場合は？ → 最新の10件のワークアウト（作成時刻による）のみを表示

## 要件 *(必須)*

### 機能要件

- **FR-001**: システムは、最近のワークアウトアコーディオンでワークアウト日付を降順の時系列順（最新の日付が最初、最古の日付が最後）で表示しなければならない
- **FR-002**: システムは、日付でグループ化する前にワークアウトを作成タイムスタンプ（createdAtフィールド）でソートし、最新の10件のワークアウトが選択されることを保証しなければならない
- **FR-003**: システムは、最近のワークアウトリストに最大10件のワークアウトエントリを表示しなければならない
- **FR-004**: システムは、同じ日付グループ内のワークアウトに対して降順の時系列順（最新の時刻が最初）を維持しなければならない
- **FR-005**: システムは、同日の複数ワークアウトに対する既存のタイムスタンプ表示形式[HH:mm]を保持しなければならない
- **FR-006**: システムは、作成時刻（createdAtフィールド）でソートしながら、ワークアウト日付（dateフィールド）でグループ化し続けなければならない

### 主要エンティティ

- **Workout**: 次の属性を含む単一のワークアウトエントリを表す：
  - `date`: ワークアウトが実施された日付（グループ化に使用）
  - `createdAt`: ワークアウトがシステムに記録されたタイムスタンプ（ソートに使用）
  - `exerciseType`: 運動の種類（cardio または strength）
  - `exercise`: 運動の名前
  - タイプに応じた追加の詳細（distance、duration、reps、setsなど）

- **Grouped Workouts**: YYYY-MM-DD形式の日付キーで、ワークアウトエントリの配列を値として組織化するオブジェクト構造

## 成功基準 *(必須)*

### 測定可能な成果

- **SC-001**: ユーザーは100%の確率でアコーディオンの最初のエントリとして最新のワークアウト日付を表示できる
- **SC-002**: ユーザーが複数の日付にわたってワークアウトを持つとき、すべての日付グループが手動ソートなしで降順の時系列順で表示される
- **SC-003**: 同じ日付に3つ以上のワークアウトを持つユーザーの場合、その日付グループ内のワークアウトが時刻の逆時系列順で表示される
- **SC-004**: 最近のワークアウトリストは、ワークアウト日付に関係なく、一貫して最新に作成された10件のワークアウトエントリを表示する
- **SC-005**: ユーザーは、最下部へのスクロールやエントリの手動並べ替えなしに、最新のワークアウトアクティビティをすぐに識別できる
