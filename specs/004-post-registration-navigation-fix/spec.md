# 機能仕様書: 新規登録後のナビゲーション問題修正

**フィーチャーブランチ**: `fix/post-registration-navigation`
**作成日**: 2025-11-02
**ステータス**: ドラフト
**入力**: ユーザー説明: "新規登録後のナビゲーション問題修正"

## ユーザーシナリオとテスト *(必須)*

### ユーザーストーリー 1 - 登録成功時のナビゲーション (優先度: P1)

有効な認証情報で登録フォームを完了した後、ユーザーは明確な成功メッセージとともにログインページに誘導され、新しいアカウントで即座にログインできるようになる。

**この優先度の理由**: これが核心的な問題 - 現在ユーザーは `/dashboard` にリダイレクトされますが、すぐに `/login` に戻され、成功メッセージが保持されないため、混乱を招いています。これを修正することはユーザーオンボーディングにとって重要です。

**独立したテスト**: 新しいアカウントを登録し、ユーザーがログインページに到着し、成功メッセージを確認し、正常にログインできることを検証することで完全にテスト可能。壊れたユーザージャーニーを修正することで即座に価値を提供します。

**受け入れシナリオ**:

1. **前提** ユーザーが有効なデータで登録フォームを完了した、**操作** 登録が成功した、**結果** ユーザーは `/login` ページにリダイレクトされる
2. **前提** 登録成功後にユーザーがログインにリダイレクトされた、**操作** ログインページが読み込まれた、**結果** アカウントが作成されたことを知らせる成功メッセージが表示される
3. **前提** ユーザーがログインページで登録成功メッセージを確認した、**操作** 新しく作成した認証情報を入力して送信した、**結果** 正常に認証され `/dashboard` にリダイレクトされる

---

### ユーザーストーリー 2 - 成功メッセージの可視性 (優先度: P2)

成功メッセージはエラーメッセージと明確に区別できるように表示され、適切なスタイリングを使用し、ユーザーがアクションを実行するまで表示され続ける。

**この優先度の理由**: ナビゲーション修正（P1）が核心的な問題を解決する一方で、適切なメッセージ表示により、ユーザーが何が起こったか、次に何をすべきかを理解できるようになります。完璧なスタイリングがなくても修正は機能するため、二次的な優先度です。

**独立したテスト**: 登録を完了し、成功メッセージが成功スタイリング（緑色、成功アイコンなど）で目立って表示されることを検証することでテスト可能。ユーザーの信頼性を向上させることで価値を提供します。

**受け入れシナリオ**:

1. **前提** ユーザーがログインページで登録成功メッセージを表示されている、**操作** メッセージが表示された、**結果** 成功スタイリング（エラースタイリングではない）を使用する
2. **前提** 成功メッセージが表示されている、**操作** ユーザーがログインページを表示している、**結果** メッセージはログインフォームの上または近くに明確に表示される
3. **前提** 成功メッセージが表示されている、**操作** ユーザーがログインフォームに入力を開始した、**結果** フォーム送信またはページナビゲーションまでメッセージは表示され続ける

---

### ユーザーストーリー 3 - 登録エラー処理の一貫性 (優先度: P3)

登録が失敗した場合、ユーザーは明確なエラーメッセージとともに登録ページに留まり、適切な場合はフォームデータを維持し、新しい成功フローとの一貫性を確保する。

**この優先度の理由**: エラー処理が新しい成功フローと直感的で一貫性のあるものになることを保証します。既存のエラー処理が既にかなり良く機能しているため、優先度は低めです。

**独立したテスト**: 無効なデータ（重複メール、短いパスワードなど）で登録を試み、ナビゲーションなしでエラーメッセージが正しく表示されることを検証することでテスト可能。UXの一貫性を通じて価値を提供します。

**受け入れシナリオ**:

1. **前提** ユーザーが重複したメールで登録を送信した、**操作** サーバーが409エラーを返した、**結果** ユーザーはエラーメッセージとともに `/signup` ページに留まる
2. **前提** 登録エラーが発生した、**操作** エラーメッセージが表示された、**結果** ユーザーのフォーム入力は保持される（パスワードフィールドを除く）
3. **前提** ユーザーが登録エラーを確認した、**操作** エラーを修正して再送信した、**結果** 送信が成功するとエラーメッセージがクリアされる

---

### エッジケース

- 登録は成功したが `/login` へのナビゲーションが失敗した場合はどうなるか？（登録ページに成功メッセージと手動ログインリンクを表示すべき）
- ナビゲーション中に成功メッセージの状態が失われた場合、システムはどう処理するか？（エラーではなく、メッセージなしでログインページを優雅に表示すべき）
- ログイン済みのユーザーが `/signup` にブックマークまたは直接ナビゲートした場合はどうなるか？（PublicRoute経由で `/dashboard` にリダイレクトすべき）
- 登録リクエストが保留中に高速にフォームを再送信した場合、システムはどう処理するか？（読み込み状態中はボタンを無効化すべき）
- 登録成功後のログインページからユーザーがブラウザの戻るボタンを使用した場合はどうなるか？（成功メッセージは登録ページに再表示されるべきではない）

## 要件 *(必須)*

### 機能要件

- **FR-001**: システムは登録成功直後にユーザーを `/login` ページにナビゲートしなければならない
- **FR-002**: システムは登録成功からユーザーが到着したときにログインページに成功メッセージを表示しなければならない
- **FR-003**: 成功メッセージはアカウントが作成されたことと、ログインすべきことをユーザーに通知しなければならない
- **FR-004**: 成功メッセージはエラーメッセージと区別できる成功レベルのスタイリング（例：緑色、成功アイコン）を使用しなければならない
- **FR-005**: システムは `/signup` から `/login` へリダイレクトする際、ナビゲーション状態で成功メッセージを保持しなければならない
- **FR-006**: システムはユーザーが正常にログインまたはナビゲートした後、成功メッセージをクリアしなければならない
- **FR-007**: システムは登録が失敗した場合、適切なエラーメッセージを表示して `/signup` ページにユーザーを留めなければならない
- **FR-008**: システムは登録が失敗した場合、フォーム入力値（パスワードを除く）を保持しなければならない
- **FR-009**: システムは登録リクエストの処理中、登録送信ボタンを無効化しなければならない
- **FR-010**: システムはリダイレクトが失敗した場合、登録ページに成功メッセージを表示することでナビゲーション失敗を優雅に処理しなければならない

### 主要エンティティ *(機能がデータを含む場合に含める)*

- **登録成功メッセージ**: 成功メッセージテキストと登録が正常に完了したことを示す一時的なナビゲーション状態
- **ユーザーセッション状態**: ユーザーがログインしているかどうかを追跡する認証コンテキスト、PrivateRouteがアクセスを決定するために使用

## 成功基準 *(必須)*

### 測定可能な成果

- **SC-001**: 登録成功後にログインページに到着したユーザーは、ページ読み込みから100ミリ秒以内に成功メッセージを確認できる
- **SC-002**: 成功した登録の100%が `/login` ページへのナビゲーションになる（`/dashboard` ではない）
- **SC-003**: ユーザーは登録完了から30秒以内に新しく作成した認証情報で正常にログインできる
- **SC-004**: 登録からログインへのナビゲーション中に成功メッセージが失われるインスタンスはゼロ
- **SC-005**: 失敗した登録試行の100%で登録エラーメッセージが `/signup` ページに表示され続ける

## 前提条件

- バックエンドの `/authrouter/register` エンドポイントは認証トークンを提供せずに成功を返し続ける（自動ログイン機能は追加されない）
- React Routerの `useNavigate` と state パラメータはナビゲーション中に確実に状態を保持する
- Loginコンポーネントは location state メッセージを受け入れて表示するように変更できる
- ユーザーはJavaScriptが有効で、React Router v6の機能をサポートする最新ブラウザを使用している
- 成功メッセージは現在エラーに使用されているのと同じAlertコンポーネントパターンを使用して表示される
