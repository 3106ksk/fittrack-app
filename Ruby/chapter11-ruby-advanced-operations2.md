# 11章 Rubyを使った複雑な操作(2)

## 例外の基本

### 例外とは

例外（Exception、エクセプション）は、プログラムの実行中に発生するエラーや異常な状態を指します。

通常のプログラムの流れを中断し、特別な処理を行う必要があります。例外が発生すると、プログラムはその例外に対応するための処理を探し始めます。

#### 1. chapter11 ディレクトリを作成してください。

```bash
mkdir chapter11
```

#### 2. chapter11/exception.rb ファイルを作成し、次のコードを記述してください。

```ruby
puts "String" + 1
```

#### 3. ファイルを保存後、以下のコマンドでスクリプトを実行してください。(コンテナ内で実行してください)

```bash
ruby chapter11/exception.rb
```

**実行結果**

```
root@4d904ed79b93:/app$ ruby chapter11/exception.rb
chapter11/exception.rb:1:in `+': no implicit conversion of Integer into String (TypeError)

puts "String" + 1
                ^
        from chapter11/exception.rb:1:in `<main>'
```

### まとめ

例外が起こる条件は、プログラムの実行中に発生するエラーや異常な状態です。例外が発生すると、プログラムはその例外に対応するための処理を探し始めます。

サンプルコードでは、文字列のStringと数値の1という違うデータ型を+演算子で結合しようとしているため、例外が発生しています。

### よくある例外の例

| 例外の種類 | 説明 | 例 |
|-----------|------|-----|
| NoMethodError | メソッドが存在しない場合に発生します。 | nilに対してメソッドを呼び出すと発生します。 |
| NameError | 変数や定数が存在しない場合に発生します。 | 未定義の変数を参照すると発生します。 |
| SyntaxError | 構文エラーが発生した場合に発生します。 | 括弧の閉じ忘れなどで構文が間違っている場合に発生します。 |
| ArgumentError | メソッドに対して不正な引数が渡された場合に発生します。 | 引数の数が合わない場合に発生します。 |
| ZeroDivisionError | 0で割り算を行った場合に発生します。 | 0で割り算を行うと発生します。 |

### 例外に対処する

例外に対処する方法は、beginとrescueを使って例外をキャッチする方法があります。

#### 1. chapter11/exception.rb ファイルを以下の内容に編集してください。

```ruby
begin
  puts "String" + 1
rescue TypeError => e
  puts "エラーが発生しました: #{e.message}"
end
```

#### 2. ファイルを保存後、以下のコマンドでスクリプトを実行してください。(コンテナ内で実行してください)

```bash
ruby chapter11/exception.rb
```

**実行結果**

```
root@4d904ed79b93:/app$ ruby chapter11/exception2.rb
エラーが発生しました: no implicit conversion of Integer into String
```

### まとめ

例外に対処する方法は、beginとrescueを使って例外をキャッチする方法があります。

サンプルコードでは、beginとrescueを使って、TypeErrorの例外をキャッチして、エラーメッセージを表示しています。

どんな例外が発生するかわからない場合は、rescueの後に`=> e`を追加して、直接例外オブジェクトを取得して、エラーメッセージを表示することも出来ますが、意図していない例外をキャッチしてしまう可能性があるため、注意が必要です。

## 正規表現の基本

### 正規表現とは

正規表現（Regular Expression、略してRegex）は、文字列のパターンを記述するための記法です。

正規表現を使用すると特定のパターンに一致する文字列を検索したり、置換したりすることができます。

### 正規表現で使用する記号例

| 記号 | 説明 |
|-----|------|
| . | 任意の1文字にマッチします。 |
| ^ | 行の先頭にマッチします。 |
| $ | 行の末尾にマッチします。 |
| * | 直前の文字が0回以上繰り返しにマッチします。 |
| + | 直前の文字が1回以上繰り返しにマッチします。 |
| ? | 直前の文字が0回または1回にマッチします。 |
| [] | 括弧内のいずれかの文字にマッチします。 |
| () | グループ化を行います。 |
| \ | 特殊文字をエスケープします。 |
| \| | 複数のパターンを指定します。 |

詳しくは触れませんが、様々な記号を組み合わせて、複雑なパターンを記述することができます。

### Rubyでの正規表現の使い方

#### 1. chapter11/regex.rb ファイルを作成し、次のコードを記述してください。

```ruby
pattern = /Ruby/

puts "Ruby".match(pattern)
puts "Python".match(pattern)
```

#### 2. ファイルを保存後、以下のコマンドでスクリプトを実行してください。(コンテナ内で実行してください)

```bash
ruby chapter11/regex.rb
```

**実行結果**

```
root@4d904ed79b93:/app$ ruby chapter11/regex.rb
Ruby

```

### まとめ

正規表現を使用すると特定のパターンに一致する文字列を検索したり、置換したりすることができます。

サンプルコードでは、`/Ruby/`という正規表現パターンを作成し、matchメソッドを使って、文字列RubyとPythonに対して、正規表現パターンに一致するかどうかを確認しています。

Rubyという文字列は、正規表現パターンに一致しているため、Rubyという文字列が表示されます。Pythonという文字列は、正規表現パターンに一致していないため、何も表示されません。

### scanメソッドを使った正規表現の検索

#### 1. chapter11/scan.rb ファイルを作成し、次のコードを記述してください。

```ruby
pattern = /Ruby/

p "Ruby".scan(pattern)
p "Ruby Ruby".scan(pattern)
```

#### 2. ファイルを保存後、以下のコマンドでスクリプトを実行してください。(コンテナ内で実行してください)

```bash
ruby chapter11/scan.rb
```

**実行結果**

```
root@4d904ed79b93:/app$ ruby chapter11/scan.rb
["Ruby"]
["Ruby", "Ruby"]
```

### まとめ

scanメソッドを使うと、文字列内の正規表現パターンに一致する部分文字列を配列で取得することができます。

サンプルコードでは、`/Ruby/`という正規表現パターンを作成し、scanメソッドを使って、文字列RubyとRuby Rubyに対して、正規表現パターンに一致する部分文字列を取得しています。

### gsubメソッドを使った正規表現の置換

#### 1. chapter11/gsub.rb ファイルを作成し、次のコードを記述してください。

```ruby
pattern = /Ruby/

p "Ruby".gsub(pattern, "Python")
p "Ruby Ruby".gsub(pattern, "Python")
```

#### 2. ファイルを保存後、以下のコマンドでスクリプトを実行してください。(コンテナ内で実行してください)

```bash
ruby chapter11/gsub.rb
```

**実行結果**

```
root@4d904ed79b93:/app$ ruby chapter11/gsub.rb
Python
Python Python
```

### まとめ

gsubメソッドを使うと、文字列内の正規表現パターンに一致する部分文字列を置換することができます。

サンプルコードでは、`/Ruby/`という正規表現パターンを作成し、gsubメソッドを使って、文字列RubyとRuby Rubyに対して、正規表現パターンに一致する部分文字列を置換しています。

## まとめ

Rubyを使った少し高度なプログラミングの基本を学びました。

例外の概念や正規表現を理解するとプログラムの品質を向上させたりプログラムを効率的に実装することができます。