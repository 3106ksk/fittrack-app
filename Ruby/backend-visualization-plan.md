# 健康スコア可視化フォーカスの機能整理

## 現状機能と拡張アイデア
| 現状機能 (Node/Express) | 役割 | 可視化軸での拡張アイデア | 追加で必要なデータ/実装 |
| --- | --- | --- | --- |
| SmallWins週間スコア算出 `/api/insights/current` | 今週の総合/有酸素/筋力スコアとWHO達成可否を返却 | 週次推移API（過去12週のスコア折れ線）、月次集計API（カレンダー＋平均） | `insights` に計算バージョンと週番号を保持、`GET /api/insights/history?weeks=12` |
| ワークアウト取得 `/workouts` | 最新100件の生データ取得 | 可視化用の集計レスポンス（種別別時間/距離、強度ヒートマップ） | 集計クエリ or マテビュー的エンドポイント `GET /api/workouts/stats?range=week` |
| WHO達成フラグ (cardio/strength) | 達成/未達をブールで返却 | 達成日ハイライト用の「週内日別ステータス」配列 | SmallWins計算結果に日次配列を付与（Cardio byDay, Strength trainingDays） |
| 健康メッセージ & 推奨 | 簡易メッセージ/推奨配列 | 状態に応じたカード群（不足分カウントダウン、次の行動提案） | 推奨を構造化 `{type:'cardio', missingMinutes, suggestion}` として返却 |
| Strava同期 | 活動のインポートと重複防止 | 可視化同期ステータス（最終同期日時、取り込み件数、エラー詳細） | `strava_sync_logs` テーブル or `insights` に同期メタを格納し `GET /api/strava/status` を拡張 |
| CORS/ヘルスチェック | 運用基盤の土台 | 可観測性: メトリクス/ログの可視化パネル連携 | リクエストID付きログ、軽量メトリクスエンドポイント追加 |
| テスト (Jest/Supertest) | API動作の回帰確認 | 可視化ロジックのスナップショットテスト | スコア計算/集計APIに固定フィクスチャを当てたスナップショットを追加 |

## 拡張の方向性（健康スコア可視化に特化）
1) 履歴API追加: `/api/insights/history` で週次・月次スコアを返し、折れ線/カレンダー表示を可能にする。
2) 集計API分離: `/api/workouts/stats` で種別別距離・時間・強度分布、日別カウントを返却。
3) 推奨情報の構造化: 不足分を定量値付きで返し、UIで残り分を可視化。
4) 同期可視化: Strava 同期ログを保存し、「同期済/スキップ/エラー」件数と最終同期時刻を提供。
5) 可観測性強化: リクエストID付きログと軽量メトリクスエンドポイントで運用監視を支援。

