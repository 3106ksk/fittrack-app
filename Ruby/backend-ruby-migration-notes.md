# Backend 強化のための Ruby 学習メモ

## Rubyカリキュラムとバックエンド機能対応表
| カリキュラム章 | 学べる内容 | 既存JSバックエンドで対応する箇所 | Rails移行でどう活かす |
| --- | --- | --- | --- |
| 3章 制御構文 | if/elsif, loop, each | ルートごとのバリデーション分岐（`routes/workouts.js`の強度・種別判定） | Strong Parameters + バリデーション条件をコントローラ/モデルに整理 |
| 4–5章 配列/配列操作 | map/filter/reduce | ワークアウト投稿での `repsNumber` 配列整形、Strava同期の反復処理 | ActiveRecord の `pluck`/`map`、service内での配列整形に置き換え |
| 6章 ハッシュ | キー/値操作、ネスト | JWTペイロード生成、CORS設定の動的ハッシュ (`app.js`) | Rails params/HashWithIndifferentAccess、initializerで設定管理 |
| 7章 メソッド | 引数/戻り値、デフォルト | `stravaService.encryptToken` など小関数 | サービスオブジェクトや PORO にメソッド分解 |
| 8章 クラス | クラス定義/インスタンス化 | SmallWins エンジン（`SmallWinsEngine`）、`CardioMetricsCalculator` | Rubyクラスで計算ロジックをPORO化し `app/services` に配置 |
| 9章 モジュール | 名前空間/ミックスイン | `services/smallWins/utils/DateHelper` 相当のユーティリティ | Rails `module` を `lib/` に置き、`include` で再利用 |
| 10–11章 進んだ操作 | 例外処理、Enumerable応用 | Strava API リトライ、Sequelize例外処理 | ActiveJobでのリトライ、`rescue_from` で統一エラーレスポンス、Enumerableで集計 |

## このカリキュラムでできる学習（バックエンド強化に直結）
- JSで書かれた計算・同期ロジックをRubyのクラス/モジュールに書き換える練習（章8・9）。
- バリデーション分岐や配列整形をEnumerableで簡潔に書き直す（章4–5, 10–11）。
- 例外処理とリトライをRuby流に整理（章10–11）。
- Hashとキーワード引数で設定・パラメータの扱いをRails流に寄せる（章6）。
- コントローラの責務分離を意識したメソッド抽出・サービスオブジェクト化（章7–8）。

## 学習→拡張アイデア対応表
| カリキュラム要素 | 伸ばせるバックエンド機能 | 具体的な拡張例 |
| --- | --- | --- |
| クラス/モジュール設計（章8–9） | SmallWinsエンジンのバージョニングと拡張性 | 計算バージョンをクラス分離し、戦略パターンで切替可能にする |
| Enumerable応用・配列/ハッシュ操作（章4–5,10–11） | 集計・レポート系 API | 週次/月次サマリーAPIで距離・時間・強度分布を返却 |
| 例外処理とリトライ（章10–11） | Strava同期の堅牢化 | 失敗分のみ再試行し、バックオフと履歴記録を追加 |
| メソッド分解・サービスオブジェクト（章7–8） | ワークアウト登録のバリデーション | ルールセットをサービスに集約し、手入力/Strava共通で再利用 |
| モジュールによる共通化（章9） | 認証・認可の強化 | ポリシーモジュールでリソース所有者チェックを一括適用 |
| Hash活用と設定（章6） | CORS/環境設定の明確化 | 設定をハッシュ定義で宣言的に管理し、環境別に切替 |
| 例外＋ログ整形（章10–11） | APIエラーレスポンス標準化 | 統一JSONエラー（コード/メッセージ/リクエストID）を返すレイヤを追加 |
| モジュール分割＋テストしやすさ（総合） | テストカバレッジ拡大 | 小粒サービス単位のユニットテストとStravaモックE2Eを増強 |

## 拡張の方向性（優先順）
1) SmallWins計算をクラス分離しスコアバージョン管理を導入。
2) Strava同期を再試行・履歴付きにして信頼性を向上。
3) サマリー/分析APIを追加し、週・月レポートを提供。
4) バリデーションと権限チェックをサービス/ポリシー化し、再利用性を確保。
5) エラー/ログ/設定を共通レイヤにまとめ、運用時の可観測性を高める。

