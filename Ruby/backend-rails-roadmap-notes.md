# Rails CRUD カリキュラム調査メモ

## Railsカリキュラム × 現行バックエンド対応表
| カリキュラム内容 | 学べる軸 | 現行Node版で対応する箇所 | Rails移行での置き換え/強化ポイント |
| --- | --- | --- | --- |
| scaffold で CRUD 生成 | CRUDフロー全体、7アクション | ワークアウト作成/一覧 (`backend/routes/workouts.js`)、ユーザーCRUDは未実装 | scaffoldでワークアウト相当のリソースを生成し、不要部分を削る練習。RESTful設計とルーティングを体得 |
| マイグレーションとスキーマ管理 | DB変更の手順と依存管理 | Sequelizeマイグレーション (`backend/migrations/*`) | ActiveRecordマイグレーションを手で書き、enum/JSONB/unique indexを再現し差分管理を理解 |
| ルーティングとコントローラ | HTTP→アクションの流れ、ログ読み | Expressルーター (`backend/routes/*`) | `config/routes.rb` の `resources` でルート定義し、ログを読みながらアクション特定とN+1確認 |
| ビューとヘルパー (link_to/button_to) | UI層のパス生成・HTTPメソッド指定 | 現行フロントはReact、サーバ側はJSONのみ | API専用モードでも `button_to` のHTTP指定やCSRF保護を理解し、リクエスト生成を明確に |
| scaffold生成物の構造把握 | モデル/コントローラ/ビュー/テストの役割 | Expressでは手作業で分割 | Railsの役割分担を俯瞰し、自動生成コードの取捨選択を練習 |
| ログの読み方 | Processing行からSQL/ビュー時間を読む | nodemon + consoleログ | RailsログでSlow QueryやN+1兆候を早期検知し、性能チューニングに活用 |

## このカリキュラムで得られる学習（バックエンド強化に直結）
- REST/7アクションの型を身体で覚え、既存APIのルーティング設計を見直す土台になる。
- マイグレーション運用をRails流で体験し、スキーマ差分管理・リネーム/ロールバックの安全手順を習得。
- scaffold生成→不要物削除の流れで「自動生成コードを精査する目」を養い、生成コマンド活用の適否を判断できる。
- Railsログの読み方を学び、ActiveRecordで発生しがちなN+1や遅延を検知する感覚をつかむ。

## 学習 → 拡張アイデア対応表
| 学習トピック | 伸ばせる既存機能 | 具体的な拡張例 |
| --- | --- | --- |
| scaffold/7アクション | ワークアウト CRUD | Rails版 `/workouts` をREST設計で実装し、Strong Parameters + model validationで入力安全性を高める |
| マイグレーション | Strava拡張・Insightsのスキーマ | token有効期限を `datetime` に統一、insights にスコアバージョン/週番号を追加するマイグレーションを設計 |
| ルーティング/リソース | インサイト履歴API | `resources :insights, only: [:index, :show]` に `collection { get :history }` を加え週次推移を提供 |
| ログ読み | 同期処理の可観測性 | RailsログにリクエストIDとパラメータサマリを残し、Strava同期の遅延/失敗を発見しやすくする |
| ビュー/ヘルパー理解 | エラー表示/レスポンス整形 | APIモードでも serializer/jbuilder を使い、エラーフォーマットを統一 |

## 拡張の方向性（優先順）
1) RailsでワークアウトCRUDをscaffold→不要箇所を削ってAPI専用にリファクタし、入力バリデーションをモデルに集約。
2) マイグレーションでスキーマ差分を整理：Strava token期限の型統一、insightsに週番号・バージョン列を追加。
3) ルーティング設計をRESTfulに再編し、インサイト履歴/統計のコレクションルートを追加。
4) ログ/可観測性を強化し、同期処理のボトルネックを検知可能にする。
5) シリアライザでレスポンスを型・キー名ともにフロント互換で固定し、UIの実装コストを下げる。

## カリキュラムセッション別 学習アプローチと意識ポイント
- 学習の意識ポイント（冒頭）: 「何を学ぶか」を明文化してから着手。Expressでの癖（ルータ直書き）を棚卸しし、Railsの役割分担に置き換える意識を持つ。
- AI活用の心得: 回答を鵜呑みにせず、Rails公式ガイドと突き合わせる。疑問は「目的/課題/原因/仮説」を列挙してからプロンプト化。
- CRUDと7アクションのインプット: 既存APIエンドポイントを7アクションにマッピングしてみる（例: `/workouts` GET→index、POST→create）。漏れや過剰なアクションを洗い出す。
- scaffold実践: 生成物を確認し「何が自動で作られるか」を把握。不要ファイルを削ることで生成ツールを使いこなす練習をする。
- マイグレーション適用: Sequelizeとの差分を意識し、`change`/`up`/`down`の責務とリネーム手順を体で覚える。`db:migrate:status` で状態管理を確認。
- サイドバーリンク編集: ビュー編集はAPIモードでは不要だが、`link_to`/`button_to` のHTTPメソッド付けを理解し、CSRFトークンの流れを掴む。
- 挙動確認ステップ: ルート→コントローラ→ビューのデータ受け渡しをトレースし、`@instance` 変数のスコープを確認。APIモードなら `render json:` で同様にトレースする。
- ログの見方: `Processing by ...` からSQL実行/時間を読む癖を付け、N+1や遅延の兆候を検知する。既存Expressログとの違いをメモしておくと移行時に役立つ。
